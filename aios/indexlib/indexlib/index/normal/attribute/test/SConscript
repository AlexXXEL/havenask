# -*- mode: python -*-
Import('env')
env = env.Clone()

cpps = [
    'attribute_merger_test_util.cpp',
    'attribute_test_util.cpp',
    'attribute_writer_helper.cpp',
    'section_attribute_test_util.cpp',
    'single_value_attribute_reader_creator.cpp',
#    'updatable_var_num_attribute_merger_test_util.cpp',
    ]

libattributetest = env.aSharedLibrary(target='indexlib_attributetest',
                                      source = cpps)

attribute_libs = [
    'indexlib_indextest_common',
    'indexlib_attributetest',
    'indexlib_test',
    'indexlib_testlib',
    'indexlib_partition',
    'indexlib_merger',
    'indexlib_table',
    'indexlib_index',
    'indexlib_index_base',
    'indexlib_document',
    'indexlib_common',
    'indexlib_plugin',
    'indexlib_config',
    'indexlib_file_system',
    'indexlib_storage',
    'indexlib_util',
    'indexlib_misc',
    'fslib-framework',
    'autil',
    'gmock',
    'gtest',
    'pthread'
]

attribute_test_sources = [
    '#indexlib/test/dotest.cpp',
    'attribute_compress_info_unittest.cpp',
    'attribute_iterator_typed_unittest.cpp',
    #'patch_attribute_modifier_unittest.cpp',
    'document_merge_info_heap_unittest.cpp',
    'attribute_offset_reader_unittest.cpp',
    'attribute_writer_unittest.cpp',
    'dfs_var_num_attribute_segment_reader_unittest.cpp',
    'docid_join_value_attribute_merger_unittest.cpp',
    'equal_value_compress_advisor_unittest.cpp',
    'equal_value_compress_dumper_unittest.cpp',
    'fixed_value_attribute_merger_unittest.cpp',
    'in_mem_single_value_attribute_reader_unittest.cpp',
    'in_mem_var_num_attribute_reader_unittest.cpp',
    'in_memory_attribute_segment_writer_unittest.cpp',
    'multi_section_meta_unittest.cpp',
    'multi_string_attribute_segment_reader_unittest.cpp',
    'multi_string_attribute_writer_unittest.cpp',
    'section_attribute_reader_unittest.cpp',
    'section_attribute_writer_unittest.cpp',
    'built_attribute_segment_modifier_unittest.cpp',
    'single_attribute_patch_reader_unittest.cpp',
    'single_attribute_segment_reader_for_merge_unittest.cpp',
    'single_value_attribute_formatter_unittest.cpp',
    'single_value_attribute_merger_unittest.cpp',
    'single_value_attribute_segment_patch_iterator_unittest.cpp',
    'single_value_attribute_reader_unittest.cpp',
    'single_value_attribute_segment_reader_unittest.cpp',
    'single_value_attribute_updater_unittest.cpp',
    'single_value_attribute_writer_unittest.cpp',
    'string_attribute_reader_unittest.cpp',
    'string_attribute_writer_unittest.cpp',
    'updatable_var_num_attribute_segment_reader_unittest.cpp',
    'update_field_extractor_unittest.cpp',
    'var_num_attribute_accessor_unittest.cpp',
    'var_num_attribute_data_iterator_unittest.cpp',
    'var_num_attribute_merger_unittest.cpp',
    'var_num_attribute_patch_file_unittest.cpp',
    'var_num_attribute_patch_reader_unittest.cpp',
    'var_num_attribute_reader_unittest.cpp',
    'var_num_attribute_segment_reader_unittest.cpp',
    'var_num_attribute_updater_unittest.cpp',
    'var_num_attribute_writer_unittest.cpp',
    'multi_field_patch_iterator_unittest.cpp',
    'single_field_patch_iterator_unittest.cpp',
    'default_attribute_field_appender_unittest.cpp',
    'multi_field_attribute_reader_unittest.cpp',
    'virtual_attribute_data_appender_unittest.cpp',
    'join_docid_attribute_reader_unittest.cpp',
    'sub_doc_patch_iterator_unittest.cpp',
    'adaptive_attribute_offset_dumper_unittest.cpp',
    #'updatable_var_num_attribute_merger_intetest.cpp',
    'compress_offset_reader_unittest.cpp',
    'uncompress_offset_reader_unittest.cpp',
    'var_num_attribute_data_formatter_unittest.cpp',
    'var_num_attribute_defrag_slice_array_unittest.cpp',
    'attribute_patch_merge_intetest.cpp',
    'dedup_patch_file_merger_unittest.cpp',
    'updatable_attribute_merger_intetest.cpp',
    'attribute_fs_writer_param_decider_unittest.cpp',
    'pack_attribute_patch_reader_unittest.cpp',
    'dedup_pack_attribute_patch_file_merger_unittest.cpp',
    'attribute_update_info_unittest.cpp',
    'attribute_update_bitmap_unittest.cpp',
    'attribute_data_info_unittest.cpp',
    'pack_attribute_iterator_typed_unittest.cpp',
    'lazy_load_single_value_attribute_reader_unittest.cpp',
    'lazy_load_var_num_attribute_reader_unittest.cpp',
    'attribute_reader_block_cache_unittest.cpp',
    'shape_attribute_intetest.cpp',
    'pack_attr_update_doc_size_calculator_unittest.cpp',
    'building_attribute_reader_unittest.cpp',
    ]


env.aTest(target = 'ie_attribute_unittest',
          source = attribute_test_sources, LIBS = attribute_libs)
